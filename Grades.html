<!DOCTYPE HTML>
<!--
	Landed by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
	Has been changed to meet this sites requirements specifically text, and images.
-->
<html>
	<head>
		<title>VirtuSchools</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script src="https://cdn.firebase.com/js/client/2.4.0/firebase.js"></script>
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<h1 id="logo"><a href="index.html">VirtuSchools</a></h1>
					<nav id="nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li>
								<a href="#">About</a>
								<ul>
									<li>
										<a href="education.html">Schools</a>
										<ul>
											<li><a href="education.html">Teacher</a></li>
											<li><a href="education.html">Student</a></li>
										</ul>
									</li>
									<li>
										<a href="companies.html">Companies</a>
										<ul>
											<li><a href="companies.html">Employer</a></li>
											<li><a href="companies.html">Employee</a></li>
										</ul>
									</li>
									<li>
										<a href="#">How It Works</a>
									</li>
									<li>
										<a href="#">2D Alternatives</a>
									</li>
								</ul>
							</li>
							<li><a id="loginLogoutBtn" href="Login.html">Login</a></li>
							<li><a href="Register.html" id="signupProfileBtn" class="button special">Sign Up</a></li>
						</ul>
					</nav>
				</header>

				<center>
					<input type="submit" onclick="window.location='UpdateProfile.html'" value="Update Profile">
					<input type="submit" onclick="window.location='Grades.html'" value="Grades">
					<input type="submit" onclick="window.location='OnlineVersion.html';" value="Go to Online Version">
				</center>

			<!-- Main -->
				<div id="main" class="wrapper style1">
					<div class="container">
						<header class="major">
							<h2>Grades:</h2>
							<p>Points and percentages given for homeworks, labs, and tests.</p>
						</header>
						<div class="row 150%">
							<div class="4u 12u$(medium)">

								<!-- Sidebar -->
									<section id="sidebar">
										<section>
											<h3>Student</h3>
											<p>Your grades for your registered class are listed below.</p>
										</section>
										<section>
											<h3>Teacher</h3>
											<p>Your students' grades are listed below.</p>
										</section>
										<section>
											<h3>Employee</h3>
											<p>Your completions are listed below.</p>
										</section>
										<section>
											<h3>Employer</h3>
											<p>Your employee's completions are listed below </p>
										</section>
									</section>

							</div>
							<div class="8u$ 12u$(medium) important(medium)">

								<!-- Content -->
									<section id="content">
										<a href="#" class="image fit"><img src="images/pic05.jpg" alt="" /></a>
										     <script>
										     	var hasAddedGrades=false;
											    var ref = new Firebase("https://flickering-fire-5865.firebaseio.com/");
											    var user=null;
											    // Register the callback to be fired every time auth state changes
											    ref.onAuth(authDataCallback)

											 
												// Create a callback which logs the current auth state
										     	function authDataCallback(authData) {
										          if (authData) {
										          	user=authData.uid;
										          	var userCourseId=null;
										          	var userType=null;
										          	var homeworkRefs=null;
										            console.log("User " + authData.uid + " is logged in with " + authData.provider);
										            document.getElementById("signupProfileBtn").href="UpdateProfile.html";
													document.getElementById("signupProfileBtn").innerHTML="My Profile";
													document.getElementById("loginLogoutBtn").href="#";
													document.getElementById("loginLogoutBtn").onclick=function() { ref.unauth(); window.location.replace("Login.html"); };
													document.getElementById("loginLogoutBtn").innerHTML="Log Out";
													userRef = ref.child("users").child(user);
            										userRef.once("value", function (snap) {
            											var userValue = snap.val();
											            if (!user) {
											                return;
											            }
											            userCourseId=userValue.course_id;
											            userType=userValue.user_type;
											            var studentsRef=ref.child("courseIds").child(userCourseId).child("students");
											        	
											        	if(!hasAddedGrades)
											        	{
													        studentsRef.once("value",function(snapshot)
													        {
													        	snapshot.forEach(function(childSnapshot)
													        	{
													        		var childid=childSnapshot.val().u_id;
													        		var childname=childSnapshot.val().first_name+" "+childSnapshot.val().last_name;
													        		var dateObj = new Date();
																	var month = dateObj.getUTCMonth() + 1; //months from 1-12
																	var day = dateObj.getUTCDate();
																	var year = dateObj.getUTCFullYear();
													        		var totalEarnedPoints=0;
													        		var totalPossiblePoints=0;
													        		var totalGrade=0;
													        		if(userType=="Student")
													        		{
														        		if(childid==user)
														        		{
														        			homeworkRefs=studentsRef.child(childSnapshot.key()).child("homeworks");
														        			homeworkRefs.once("value",function(snapshot2)
														        			{
														           				snapshot2.forEach(function(childSnapshot2)
															      				{
															       					var para = document.createElement("p");
																					var node = document.createTextNode(childSnapshot2.key()+" : "+childSnapshot2.val().points_earned+" / "+childSnapshot2.val().points_possible+" = "+childSnapshot2.val().grade+" % "+"\t\t\t"+childSnapshot2.val().date);
																					para.appendChild(node);
																					$('#gradesSection').append(para);
															        				totalEarnedPoints+=childSnapshot2.val().points_earned;
															        				totalPossiblePoints+=childSnapshot2.val().points_possible;
															        			});

															        			var para = document.createElement("p");
																				var node = document.createTextNode("Total : "+totalEarnedPoints+" / "+totalPossiblePoints+" = "+(totalEarnedPoints/totalPossiblePoints)+" % "+"\t\t\t"+year+"/"+month+"/"+day);
																				para.appendChild(node);
																				$('#gradesSection').append(para);
																			})
														        		}
													        		}
													        		else if(userType=="Teacher")
													        		{
													        			
																		homeworkRefs=studentsRef.child(childSnapshot.key()).child("homeworks");
														        		homeworkRefs.once("value",function(snapshot2)
														        		{
														         			var para = document.createElement("p");
																			var node = document.createTextNode(childname);
																			para.appendChild(node);
																			$('#gradesSection').append(para);
															        		snapshot2.forEach(function(childSnapshot2)
															        		{
															        			var para = document.createElement("p");
																				var node = document.createTextNode(childSnapshot2.key()+" : "+childSnapshot2.val().points_earned+" / "+childSnapshot2.val().points_possible+" = "+childSnapshot2.val().grade+" % "+"\t\t\t"+childSnapshot2.val().date);
																				para.appendChild(node);
																				$('#gradesSection').append(para);
															        			totalEarnedPoints+=childSnapshot2.val().points_earned;
															        			totalPossiblePoints+=childSnapshot2.val().points_possible;
															        		});
														        			var para = document.createElement("p");
																			var node = document.createTextNode("Total : "+totalEarnedPoints+" / "+totalPossiblePoints+" = "+(totalEarnedPoints/totalPossiblePoints)+" % "+"\t\t\t"+year+"/"+month+"/"+day);
																			para.appendChild(node);
																			$('#gradesSection').append(para);
																			var para = document.createElement("hr");
																			$('#gradesSection').append(para);
																		});
													        		}
													        });
														  });
														}
														hasAddedGrades=true;
													});
										          } else {
										          	document.getElementById("signupProfileBtn").href="Register.html";
													document.getElementById("signupProfileBtn").innerHTML="Sign Up";
													document.getElementById("loginLogoutBtn").href="Login.html";
													document.getElementById("loginLogoutBtn").onclick=function(){ window.location="Login.html"};
													document.getElementById("loginLogoutBtn").innerHTML="Login";
										            console.log("User is logged out");
										          }
										        }
										        // Register the callback to be fired every time auth state changes
										        ref.onAuth(authDataCallback)
										       // ref.on('child_added', ref.getAuth());
										    </script>
										    
										    <h2>Current Grades</h2>
										    <div id="gradesSection"></div>

										    <hr style="border: dashed 3px;" />					  
										    
										    <style>
										      div.transbox
										      {
										        opacity: 0.65;
										      }
										    </style>
										    <style>
											    p {
												    white-space: pre;
												} 
											</style>
								</section>
							</div>
						</div>
					</div>
				</div>
								
					<!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="#" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="https://www.facebook.com/virtuschools" class="icon alt fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon alt fa-linkedin"><span class="label">LinkedIn</span></a></li>
						<li><a href="#" class="icon alt fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
						<li><a href="#" class="icon alt fa-envelope"><span class="label">Email</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; VirtuSchools. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>